const extpay=ExtPay("unsubscriby-for-youtube");let prevent;const unsubscriber=function(){const t=(t,e)=>{const n=document.getElementById("unsubscriby-counter");n&&(n.textContent=`Unsubscribed: ${t} of ${e}`)},e=()=>{const t=document.getElementById("unsubscriby-loading-overlay");t&&t.remove();const e=document.querySelector("style[data-unsubscriby]");e&&e.remove()},n=()=>{const t=document.getElementById("unsubscriby-channellist-overlay");t&&t.remove()},s=()=>{prevent=!0,e(),n(),chrome.runtime.sendMessage({type:"msg",msg:"start again",running:!1,message:"stopped"})},o=async function(){return await storageGet(CONSTANTS.CSS_PATH_KEY)},r=(t,e)=>new Promise((s=>{n();const o=(()=>{const t=document.querySelectorAll("ytd-channel-renderer");return Array.from(t).map((t=>{const e=t.querySelector("#text.ytd-channel-name");return e?e.textContent.trim():"Unknown Channel"}))})(),r=document.createElement("div");r.id="unsubscriby-channellist-overlay",r.style.position="fixed",r.style.top="0",r.style.left="0",r.style.width="100%",r.style.height="100%",r.style.backgroundColor="rgba(0, 0, 0, 0.9)",r.style.zIndex="9999",r.style.display="flex",r.style.flexDirection="column",r.style.justifyContent="flex-start",r.style.alignItems="center",r.style.color="white",r.style.fontFamily="Arial, sans-serif",r.style.overflow="hidden";const c=document.createElement("style");c.setAttribute("data-unsubscriby","true"),c.textContent="\n\t\t\t\t#unsubscriby-channellist {\n\t\t\t\t\twidth: 80%;\n\t\t\t\t\tmax-height: 60vh;\n\t\t\t\t\toverflow-y: auto;\n\t\t\t\t\tpadding: 10px;\n\t\t\t\t\tmargin: 10px 0;\n\t\t\t\t\tbackground-color: rgba(32, 32, 32, 0.8);\n\t\t\t\t\tborder-radius: 8px;\n\t\t\t\t}\n\t\t\t\t.unsubscriby-channel-item {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tpadding: 8px;\n\t\t\t\t\tborder-bottom: 1px solid rgba(255, 255, 255, 0.1);\n\t\t\t\t}\n\t\t\t\t.unsubscriby-channel-item:hover {\n\t\t\t\t\tbackground-color: rgba(255, 255, 255, 0.1);\n\t\t\t\t}\n\t\t\t\t.unsubscriby-checkbox {\n\t\t\t\t\tmargin-right: 10px;\n\t\t\t\t\twidth: 18px;\n\t\t\t\t\theight: 18px;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t}\n\t\t\t\t.unsubscriby-checkbox:disabled {\n\t\t\t\t\topacity: 0.5;\n\t\t\t\t\tcursor: not-allowed;\n\t\t\t\t}\n\t\t\t\t.unsubscriby-controls {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tjustify-content: space-between;\n\t\t\t\t\twidth: 80%;\n\t\t\t\t\tmargin: 20px 0;\n\t\t\t\t}\n\t\t\t\t.unsubscriby-btn {\n\t\t\t\t\tpadding: 10px 20px;\n\t\t\t\t\tborder: none;\n\t\t\t\t\tborder-radius: 4px;\n\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\ttransition: background-color 0.3s;\n\t\t\t\t}\n\t\t\t\t.unsubscriby-btn:disabled {\n\t\t\t\t\topacity: 0.5;\n\t\t\t\t\tcursor: not-allowed;\n\t\t\t\t}\n\t\t\t\t.unsubscriby-primary {\n\t\t\t\t\tbackground-color: #3ea6ff;\n\t\t\t\t\tcolor: black;\n\t\t\t\t}\n\t\t\t\t.unsubscriby-primary:hover:not(:disabled) {\n\t\t\t\t\tbackground-color: #0f90fa;\n\t\t\t\t}\n\t\t\t\t.unsubscriby-secondary {\n\t\t\t\t\tbackground-color: #717171;\n\t\t\t\t\tcolor: white;\n\t\t\t\t}\n\t\t\t\t.unsubscriby-secondary:hover:not(:disabled) {\n\t\t\t\t\tbackground-color: #505050;\n\t\t\t\t}\n\t\t\t\t.unsubscriby-danger {\n\t\t\t\t\tbackground-color: #ff0000;\n\t\t\t\t\tcolor: white;\n\t\t\t\t}\n\t\t\t\t.unsubscriby-danger:hover:not(:disabled) {\n\t\t\t\t\tbackground-color: #cc0000;\n\t\t\t\t}\n\t\t\t\t.unsubscriby-upgrade {\n\t\t\t\t\tbackground: linear-gradient(145deg, #8a6a00, #ffd700);\n\t\t\t\t\tcolor: #000;\n\t\t\t\t\tborder: 1px solid gold;\n\t\t\t\t\tbox-shadow: 0 0 10px rgba(255, 215, 0, 0.5);\n\t\t\t\t\tposition: relative;\n\t\t\t\t\toverflow: hidden;\n\t\t\t\t}\n\t\t\t\t.unsubscriby-upgrade:hover {\n\t\t\t\t\tbackground: linear-gradient(145deg, #ffd700, #8a6a00);\n\t\t\t\t\tbox-shadow: 0 0 15px rgba(255, 215, 0, 0.7);\n\t\t\t\t}\n\t\t\t\t.unsubscriby-upgrade::after {\n\t\t\t\t\tcontent: '';\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\ttop: -50%;\n\t\t\t\t\tleft: -50%;\n\t\t\t\t\twidth: 200%;\n\t\t\t\t\theight: 200%;\n\t\t\t\t\tbackground: rgba(255, 255, 255, 0.1);\n\t\t\t\t\ttransform: rotate(30deg);\n\t\t\t\t\tanimation: shimmer 3s infinite linear;\n\t\t\t\t}\n\t\t\t\t@keyframes shimmer {\n\t\t\t\t\t0% {\n\t\t\t\t\t\ttransform: translateX(-50%) rotate(30deg);\n\t\t\t\t\t}\n\t\t\t\t\t100% {\n\t\t\t\t\t\ttransform: translateX(50%) rotate(30deg);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t.unsubscriby-header {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tjustify-content: space-between;\n\t\t\t\t\twidth: 80%;\n\t\t\t\t\tmargin-top: 20px;\n\t\t\t\t}\n\t\t\t\t.unsubscriby-title {\n\t\t\t\t\tfont-size: 24px;\n\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\tmargin: 0;\n\t\t\t\t}\n\t\t\t\t.unsubscriby-counter {\n\t\t\t\t\tfont-size: 16px;\n\t\t\t\t\tmargin-top: 10px;\n\t\t\t\t}\n\t\t\t\t.unsubscriby-premium-badge {\n\t\t\t\t\tdisplay: inline-flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tbackground-color: gold;\n\t\t\t\t\tcolor: black;\n\t\t\t\t\tpadding: 3px 8px;\n\t\t\t\t\tborder-radius: 12px;\n\t\t\t\t\tfont-size: 12px;\n\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\tmargin-left: 10px;\n\t\t\t\t}\n\t\t\t\t.unsubscriby-premium-message {\n\t\t\t\t\tbackground-color: rgba(255, 215, 0, 0.1);\n\t\t\t\t\tborder: 1px solid gold;\n\t\t\t\t\tborder-radius: 8px;\n\t\t\t\t\tpadding: 10px;\n\t\t\t\t\tmargin-top: 10px;\n\t\t\t\t\twidth: 80%;\n\t\t\t\t\ttext-align: center;\n\t\t\t\t}\n\t\t\t",document.head.appendChild(c);const i=document.createElement("div");i.className="unsubscriby-header";const a=document.createElement("h1");if(a.className="unsubscriby-title",a.textContent="Select channels to unsubscribe",!e){const t=document.createElement("span");t.className="unsubscriby-premium-badge",t.innerHTML='<i class="fas fa-crown" style="margin-right: 5px;"></i> PREMIUM',a.appendChild(t)}i.appendChild(a);const l=document.createElement("div"),u=document.createElement("button");u.className="unsubscriby-btn unsubscriby-secondary",u.style.marginRight="10px",u.textContent="Select All",u.disabled=!e,u.onclick=()=>{e&&(document.querySelectorAll(".unsubscriby-checkbox").forEach((t=>{t.checked=!0})),f())};const d=document.createElement("button");if(d.className="unsubscriby-btn unsubscriby-secondary",d.textContent="Clear Selection",d.disabled=!e,d.onclick=()=>{e&&(document.querySelectorAll(".unsubscriby-checkbox").forEach((t=>{t.checked=!1})),f())},l.appendChild(u),l.appendChild(d),i.appendChild(l),r.appendChild(i),!e){const t=document.createElement("div");t.className="unsubscriby-premium-message",t.innerHTML='<i class="fas fa-lock" style="margin-right: 5px;"></i> Manual channel selection is a premium feature. Upgrade to select which channels you want to unsubscribe from.',r.appendChild(t)}const b=document.createElement("div");b.className="unsubscriby-counter",b.id="unsubscriby-selection-counter",b.textContent=e?`Selected: 0 of ${t.length}`:`Total channels: ${t.length} (Maximum of ${CONSTANTS.LIMIT} in free mode)`,r.appendChild(b);const m=document.createElement("div");m.id="unsubscriby-channellist";for(let n=0;n<t.length;n++){const t=document.createElement("div");t.className="unsubscriby-channel-item";const s=document.createElement("input");s.type="checkbox",s.className="unsubscriby-checkbox",s.dataset.index=n,s.disabled=!e,e?s.onchange=f:n<CONSTANTS.LIMIT&&(s.checked=!0);const r=document.createElement("span");r.textContent=o[n]||`Channel ${n+1}`,!e&&n<CONSTANTS.LIMIT&&(r.style.fontWeight="bold"),t.appendChild(s),t.appendChild(r),m.appendChild(t)}r.appendChild(m);const y=document.createElement("div");y.className="unsubscriby-controls";const p=document.createElement("button");p.className="unsubscriby-btn unsubscriby-primary",p.textContent=e?"Unsubscribe Selected Channels":"Unsubscribe First "+CONSTANTS.LIMIT+" Channels",p.onclick=()=>{if(e){const t=[];if(document.querySelectorAll(".unsubscriby-checkbox:checked").forEach((e=>{t.push(parseInt(e.dataset.index))})),0===t.length)return void alert("Please select at least one channel to unsubscribe from.");n(),s(t)}else{const e=Array.from({length:Math.min(CONSTANTS.LIMIT,t.length)},((t,e)=>e));n(),s(e)}};const g=document.createElement("button");g.className="unsubscriby-btn unsubscriby-danger",g.textContent="Cancel",g.onclick=()=>{n(),s([])};const h=document.createElement("button");function f(){if(e){const e=document.querySelectorAll(".unsubscriby-checkbox:checked").length,n=document.getElementById("unsubscriby-selection-counter");n&&(n.textContent=`Selected: ${e} of ${t.length}`)}}h.className="unsubscriby-btn unsubscriby-upgrade",h.innerHTML='<i class="fas fa-crown" style="color: black; margin-right: 5px;"></i> Upgrade to Premium',h.onclick=()=>{chrome.runtime.sendMessage({message:"purchase"})},y.appendChild(g),e||y.appendChild(h),y.appendChild(p),r.appendChild(y),document.body.appendChild(r)}));return{start:async()=>{const n=await extpay.getUser();n.paid&&await(async()=>{console.log("scrolling start");const t=t=>new Promise((e=>setTimeout(e,t))),e=await o();let n=document.querySelector(e.continuation);for(;n;)console.log("continuation"),window.scrollBy(0,1e5),await t(500),n=document.querySelector(e.continuation);console.log("finished scrolling")})();const c=await o(),i=document.querySelectorAll(c.button);if(!i||void 0===i||0===i.length)return void chrome.runtime.sendMessage({type:"msg",msg:"you dont have any subs",running:!1});const a=await r(i,n.paid);if(0===a.length)return;const l=n.paid?a:a.slice(0,CONSTANTS.LIMIT);console.log(`#selected subs: ${l.length} of ${i.length} total`),document.title=`Unsubscribing... 0/${l.length}`,prevent=!1,chrome.runtime.sendMessage({type:"msg",msg:"click to stop",running:!0}),(()=>{e();const t=document.createElement("div");t.id="unsubscriby-loading-overlay",t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(0, 0, 0, 0.7)",t.style.zIndex="9999",t.style.display="flex",t.style.flexDirection="column",t.style.justifyContent="center",t.style.alignItems="center",t.style.color="white",t.style.fontFamily="Arial, sans-serif";const n=document.createElement("div");n.id="unsubscriby-spinner",n.style.border="5px solid rgba(255, 255, 255, 0.3)",n.style.borderTop="5px solid #fff",n.style.borderRadius="50%",n.style.width="50px",n.style.height="50px",n.style.animation="unsubscriby-spin 1s linear infinite";const o=document.createElement("style");o.setAttribute("data-unsubscriby","true"),o.textContent="\n\t\t\t@keyframes unsubscriby-spin {\n\t\t\t\t0% { transform: rotate(0deg); }\n\t\t\t\t100% { transform: rotate(360deg); }\n\t\t\t}\n\t\t",document.head.appendChild(o);const r=document.createElement("div");r.id="unsubscriby-counter",r.style.marginTop="20px",r.style.fontSize="18px",r.style.fontWeight="bold",r.textContent="Preparing...";const c=document.createElement("button");c.id="unsubscriby-cancel-button",c.textContent="Cancel",c.style.marginTop="20px",c.style.padding="10px 20px",c.style.backgroundColor="#ff0000",c.style.color="white",c.style.border="none",c.style.borderRadius="4px",c.style.cursor="pointer",c.style.fontWeight="bold",c.style.fontSize="16px",c.style.transition="background-color 0.3s ease",c.addEventListener("mouseover",(()=>{c.style.backgroundColor="#cc0000"})),c.addEventListener("mouseout",(()=>{c.style.backgroundColor="#ff0000"})),c.onclick=()=>{s()},t.appendChild(n),t.appendChild(r),t.appendChild(c),document.body.appendChild(t)})(),t(0,l.length);const u=s=>{prevent?e():s<l.length?setTimeout((()=>{const e=a[s];i[e]&&i[e].click(),setTimeout((()=>{const e=document.querySelector(c.confirmButton);e&&(e.click(),document.title=`Unsubscribing... ${s+1}/${l.length}`,t(s+1,l.length)),u(s+1)}),50+s)}),100+s):(e(),n.paid?chrome.runtime.sendMessage({message:"complete",count:l.length}):confirm("Finished! Refresh the page to continue. Run this process only once by going premium.")&&chrome.runtime.sendMessage({message:"purchase"}),document.title=`Process Complete ${s}/${l.length}`)};u(0)},stop:s,getSubs:async()=>{const t=await o();return document.querySelectorAll(t.button)}}}();chrome.runtime.onMessage.addListener((async(t,e,n)=>{if("start"===t.message){console.log("contentscript received start!");const t=await unsubscriber.getSubs();t&&t.length>0?confirm("Click OK to begin unsubscribing. Unsubscriby For Youtube.")&&unsubscriber.start():alert("There are no subscriptions to be unsubscribed! Unsubscriby For Youtube.")}"stop"===t.message&&(console.log("contentscript received stop!"),unsubscriber.stop()),"ping"===t.message&&n("pong")}));
